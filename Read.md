# 项目 构思与基本构架阶段
## 遇到的问题：
选择项目的架构
* 首先：只需要一个启动模块-----
    * 产生的问题 其它模块不启动就没有web 就没办法通过view进行调用
    * 解决 ：使用方法调用
    * 问题2：模块不启动就没有创建ioc容器，单例bean多列bean都不好使
    * 解决：只能使用原始的自己创建对象
    * 问题3：没有ioc注入bean mapper的映射就无法使用，mysql的持久层操作又要用原始的
    *解决： 使用多模块项目 每个模块如果都是spring boot项目
        * 就能解决ioc的问题
    * 但是还是存在模块之间的相互访问调用的问题（待解决）---使用Eureka+OpenFeign
    * 且使用多spring boot 模块的项目势必要占用大量的内存，每个模块都是一个应用程序（至此还是无法清晰认识到多模块项目和分布式的区别）---多模块就是一种分布式的思想
    
* 最后选择了使用spring boot多模块进行开发，按功能进行模块的划分，减小代码之间的耦合度，清晰，便于后期的维护
模块使用

# 项目开发阶段
## 首页前端部分与用户登录
### 遇到问题
* 前端界面是独立一个模块还是分别写在各个模块中
* 使用独立的一个模块--例如贴吧的首页就需要从多个模块获取数据（bar-model、recommend-model、commend-model...）
* 进入某个贴吧也会发现该页面也需要多个模块的数据比较复杂
* 所以前端部分单独放在一个模块中便于管理、维护和相互访问跳转



#### 登录/注册部分
* 问题1：点击登录触发异步请求后服务端发回什么数据给前端
* 解决：登录时需要携带用户相关的信息到服务端进行存储
* 问题2：携带的用户数据涉及到敏感信息，传输的时候可能会被抓包导致用户信息的泄漏
* 解决：使用jwt的思想进行数据的加密传输、存储（有待）

* 问题3：xhr.open("post","http://localhost:9000/login",true);跨域请求不行，会出现跨域资源共享（CORS）问题
  * 解决：继承创建一个config类WebMvcConfigurer类，进行配置
    * 然后在想要允许跨域请求的contoller层方法上加 @CrossOrigin注解
##### 相关知识
  * CORS跨域请求（不同端口）
    * 预检请求：在跨域请求来到时先进行“过滤”，如果符合配置的一系列要求就“放行”

#### 登录后跳到登录后的页面
* 会根据个人偏好进行中间部分的帖子的推荐（具体推荐的方法在页面推荐部分）

<script src="js/signUp.js"></script>   引入的位置不同会造成不同的影响？
引入位置的不同会造成内容的加载顺序不同，效果上不会有不同（暂时是如此）

## 创建贴吧
* 贴吧创建完成后跳转到该贴吧的页面（所有贴吧共用一个页面，各个贴吧都是异步请求得到数据）~~
* 注意创建时贴吧类型用下拉框选择，如何获取被选中的数据---使用类属性，然后获取相同类属性的标签判断哪个被选择了
* 创建时间
## 发布帖子
问题：
* 文件上传：分片上传、视频播放
* bar的信息，id，name等等的携带方式
* 不同的用户接收各自关注的贴吧发的消息--不行不行，消息太多了，换一种通知
* 可以考虑换成接收其它用户发送的消息
* 插入返回自增长主键时，可能返回的不是自增长主键值是插入结果 
* 解决：直接从返回对象拿比较好，不然可能返回的是插入的结果
* 一个注意点：上传含文件的表单异步请求到服务端的时候，注意js代码中不要设置请求体的格式为multipat/form-data
因为传含文件的表单（formdata数据）前端会自动认定请求体为mul..格式，加了反而错
* 还有就是获取表单中文件的dom对象是一个伪数组，因为默认是可以传多个文件，所以要用索引获取指定的文件
* 发布时间

## 页面内容的显示
* 有三种显示方式三种：单纯前端三剑客，加jsp，加thymeleft
### 帖子页面内容的显示
*内容：帖子内容和评论区
* 帖子内容的分类显示
不同类型的文件，前端引用的标签不一样（图片、视频）
* 需要在后端进行分类
* 评论时间
### 登录前的页面内容
* 思路
使用多因素加权统计帖子的推荐分数，以浏览量为主（防止有个别的人在评论区发相当数量的评论，导致该帖子被认定为热门的帖子被推荐）统计浏览量前10的帖子
再对这些帖子以浏览量和评论数6、4的权重计算出分数最高的3（自定义的）个帖子进行推荐，过程中都使用redis的zSet存储和统计
前提：被推荐的帖子应该具有时效性，所以被推荐的帖子的前提是发布时间为3天内（自定义）

* 问题：
  * 怎么动态改变标签中的文本内容
  * 解决：dom对象
  * 怎么显示页面上的内容
    * 首先是推荐算法，哪些吧的哪些帖子被显示了页面上
    * 选择完之后如何显示内容
    * 解决：使用异步请求，但是绑定的事件又是什么呢？--全局监听事件
      根据服务端传回的响应报文动态创建帖子内容区

登录（甚至进贴吧）以后的逻辑大多都会遇到的问题： 用户信息，贴吧信息的携带，多端口之间的共享
解决方法：
* --解决方法：
    * 首先想到的是cookie和session，但是两者都无法（或较难，也不太适合）跨端口进行数据的共享
    * 然后就是Header，利用较新的技术localStorage 在前端中转（使用localStorage，会把数据持久化到浏览器内存，cookie虽然也行，但是cookie的携带仅限于当前端口，不能跨端口
      把数据传输到js页面由js页面进行持久化，再添加在请求头上，让其它模块可以获取其数据）进行请求头的设置，从而首先数据在多端口间的共享
    * 然后就会遇到一个问题：登录的时候发到服务端的异步请求需要传回两个数据
        * 登录的状态
        * 登陆成功时该用户相关信息的携带
        * 没有可以封装这两种数据的对象，传回前端就无法进行信息的提取
        *解决：使用自定义的响应体，状态（code装载了登录的状态），请求体数据（data）就装载用户的相关信息

### 登录后页面内容显示
* 思路
    * 第一次进行偏好设置，根据偏好设置的贴吧类型选择推荐的帖子所属3个贴吧种类，
  基于此使用首页的推荐方式进行推荐，然后统计1个月内用户的访问量判断该用户对于其
  偏好中的3类贴吧的总访问量是否大于用户所有帖子访问量的50%，如果小于就判断该用
  户偏好设置非其真正喜好，自动为其重新设置偏好（新的偏好为用户这段时间内访问量前3的3个贴吧类别），
  直到1个月后重新设置偏好
    * 偏好设置
    * 用户第一次登录进行偏好设置
    * 用户浏览量达到阈值且偏好贴吧浏览量占比小于阈值进行偏好设置
    * 一个月后定期进行偏好设置
### 贴吧页面内容显示
* 帖子推荐部分：
* 推荐方法：首先考虑帖子所属的贴吧
    * 然后考虑帖子：评论，发布时间
* 思路
按帖子最新评论时间最近来推荐帖子，帖子刚创建的时候最新评论时间记为帖子的创建时间
使用redis中的zSet对象记录每个贴吧中帖子最新评论时间
然后分类查询，就先筛选对应类别的贴吧再把对应类型的贴吧合并到新的zSet对象中，进行推荐

### 页面内容显示过程中遇到的问题
* 页面之间需要有数据交互
* 问题：交互的数据如何进行传输
  * 解决：本来想用cookie， 但是cookie默认情况下也不能在多模块之间共享数据，
  配置后不知道行不行，但是就算可以也很麻烦
  *然后想用localStorage，会把数据持久化到浏览器内存，cookie虽然也行，但是cookie的携带仅限于当前端口，不能跨端口
    把数据传输到js页面由js页面进行持久化，再添加在请求头上，让其它模块可以获取其数据
    * 但是有个问题:涉及到一些敏感信息的传输需要进行加密，否则被抓包会导致敏感信息的泄漏
    * 解决：使用jwt思想进行敏感数据的加密传输和存储

# 数据库
## 遇到问题
* MySQL的服务器和driver的版本不匹配会出现时区不匹配的异常--使用8版本MySQL需要配时区，一般用的5版本不用
开启驼峰命名只能是数据库查询到的值映射到服务端的时候进行转化，不能是服务端查询的时候就用驼峰命名，无法转化为下划线命名，导致MySQL无法识别

# 异常
* NS_BINDING_ABORTED错误----
解决：前端报错一般出现在使用a标签之后，点击a标签链接，第一次的接口访问就会因为href的跳转产生的新请求而导致第一次的请求发生终止从而报错

解决方法一：

将a标签的href删去或者修改成#，防止出现新请求导致第一次请求终止
* 要注意要是想让标签显示是跳转链接（蓝色按钮）href就“javascript:void(0);”
既有链接按钮效果，还防止点击跳转，和js中的逻辑冲突

  
# 杂
* 传参的时候要注意传的顺序，不能看形参的名字，最终决定的是实参
* localStorage存储数据相同key会覆盖（底层原理可能是set）
* 超链接和onlock同时存在产生问题：
  * 冲突问题：超链接的默认行为是跳转到链接指定的 URL。如果您在超链接上绑定了点击事件，并且该事件有自定义的行为，可能会导致冲突。点击链接时，浏览器会先执行点击事件的代码，然后再执行超链接的默认行为，这可能会干扰您的预期操作。
  * 事件执行顺序问题：如果您在超链接上绑定了点击事件，并且事件处理程序代码中包含了异步操作或耗时操作，那么在点击超链接后，事件处理程序可能不会立即执行，而是在异步操作完成后才执行。这可能会导致超链接的默认行为在事件处理程序执行之前就已经触发，从而打断了预期的操作流程。
* 解决
  href="javascript:void(0);" 这个可以阻止点击超链接的默认行为（跳转）
* 问题：button和submit的使用上
* submit 点击会触发表单的提交，作为异步请求的事件，会导致两个请求产生冲突从而达不到预期的效果
* 解决：使用button


bar afterLogin login myInfo myPost preference